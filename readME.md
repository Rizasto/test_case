# Ролевое разграничение:
Для ролевого разграничения доступа были созданы 5 таблицы:
+ users - таблица с информацией о пользователях
+ permission - таблица с разрешениями на определенные действия
+ role - таблица с ролями
+ role_permission - таблица, связывающая роли и разрешения
+ user_role - таблица, связывающая пользователя и роль

При попытке что-либо сделать с данными, система запрашивает из БД разрешения для роли вошедшего пользователя
и сверяет, доступен ли ему требуемый функционал.


# Эндпоинты:
Существует три api-префикса для различных действий.
## /user
Данный префикс позволяет производить манипуляции с пользователями:
1) POST /register - регистрация пользователя
2) POST /login - вход пользователя
3) POST /logout - выход пользователя
4) PATCH /update - обновление информации о пользователе
5) DELETE /delete - удаление пользователя
## /product
Данный префикс позволяет работать с mock данными(внимание: мок данные обновляются при перезапуске приложения):
1) GET / - позволяет получить данные о всех товарах
2) GET /my - позволяет получить данные о товарах в объявлениях, владельцем которого является вошедший пользователь.
3) PATCH /update - позволяет изменить информацию о товаре с указанным id, владельцем которого является вошедший пользователь без разрешения "update_all_products" или любой записи, если такое разрешение есть.
## /role - доступны только пользователю с ролью admin
1) POST /create_permission - создает новое разрешение
2) POST /assign_permission - привязывает указанное разрешение к указанной роли.
3) GET /all - позволяет получить список всех ролей и их разрешения

# Аутентификация:
Аутентификация реализована через самописные JWT-токены типа Bearer Token. Для проверки работы всей системы необходимо использовать postman, insomnia или другие похожие программы.

В ответ на /user/login приходит bearer token, который необходимо сохранить и дальнейшие действия производить именно с ним в качестве аутентификации.

Время жизни токена указано в файле настроек settings.ini в переменной ACCESS_TTL_MIN в минутах.

/user/logout - "убивает" предыдущий токен до следующего перезапуска программы

# Предустановленные данные в БД
## Роли
1) Администратор - admin
2) Модератор - moderator
3) Пользователь - user
## Пользователи:
1) Логин: admin@admin.com, Пароль: 12345, роль: Администратор
2) Логин: moderator@moderator.com, Пароль: 12345, роль: Модератор
3) Логин: user@user.com, Пароль: 12345, роль: Пользователь
## Разрешения:
1) **get_all_products** - показать все продукты(есть у администратора и модератора)
2) **get_my_products** - показать продукты, владельцем объявления которым является вошедший пользователь(есть у всех)
3) **update_my_products** - обновить информацию о продукте, владельцем объявления которого является вошедший пользователь(есть у всех)
4) **update_all_products** - обновить информацию о любом продукте(есть у администратора и модератора)
5) Отдельно роль администратора имеет разрешение на создание разрешенией, присоединение разрешения к конкретной роли и на просмотр всех существующих разрешений у ролей.
## Mock-данные
Для тестирования разрешений созданы mock-данные в виде словарей [int, Product(Dataclass)] 

## Инструкция по сборке и запуску приложения
Для сборки и развертывания приложения понадобится docker и docker-compose.
Установка производится следующей командой из корневой папки проекта: docker-compose up --build

Удаление производится командой: docker compose down -v

